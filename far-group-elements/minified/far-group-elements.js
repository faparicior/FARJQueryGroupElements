(function(b,c,d){var a={init:function(e){return this.each(function(){var h=$.extend(true,$.fn.adminGroupLists.defaults,e);h.$content_el=$(this);h.id_container=$(this).attr("id");$(this).data("settings",$.extend(true,{},h));a.clearElements(h,"far_master_elements");a.clearElements(h,"far_elements");a.clearElements(h,"far_free_elements");a.createElements(h,"far_master_elements","master");a.createElements(h,"far_elements","element");a.createElements(h,"far_free_elements","free_element");var f=h.$content_el.find("ul");var g=f.filter(".far_master_elements");var j=f.filter(".far_elements");var i=f.filter(".far_free_elements");f.find("li").attr("data-status","normal");g.off("click",".newElementMaster");j.off("click",".newElement");i.off("click",".newElementFree");f.on("keypress",".far_display",a.interceptKeys);f.on("keyup",".far_display",a.interceptEscKeys);g.on("click","li",a.masterSelected);j.on("click","li",a.elementsSelected);i.on("click","li",a.freeElementsSelected);g.on("click focus","li",a.selectChildCategories);f.on("click",".far_display-edit",a.editElement);f.on("focusout",".far_display",a.uneditElement);g.on("click",".newElementMaster",a.newElementMaster);j.on("click",".newElement",a.newElement);i.on("click",".newElementFree",a.newFreeElement);i.on("click",".far_display-tag",a.assignElement);g.on("click",".close-element",a.removeMasterElement);j.on("click",".close-element",a.removeElement);i.on("click",".close-element",a.removeFreeElement)})},masterSelected:function(){var e=$(this);var j=e.closest(".far-admin-groups");var f=e.closest("ul");var i=e.data("uid");var h=j.find(".far_elements").find("li").filter(".newElement");var g=j.find(".far_elements").find("li");f.attr("data-id-selected",i);f.find(".elementSelected").removeClass("elementSelected");g.filter(".elementSelected").removeClass("elementSelected");e.addClass("elementSelected");if(h.text()!=""){h.show()}},elementsSelected:function(){var e=$(this);e.closest("ul").find(".elementSelected").removeClass("elementSelected");e.addClass("elementSelected")},freeElementsSelected:function(){var e=$(this);e.closest("ul").find(".elementSelected").removeClass("elementSelected");e.addClass("elementSelected")},selectChildCategories:function(){var e=$(this);var i=e.closest(".far-admin-groups");var h=e.closest("ul");var f=i.find(".far_elements").find("li");var g=e.data("uid");h.attr("data-id-selected",g);f.not('[data-relid = "'+g+'"]').not(".newElement").hide();f.filter('[data-relid = "'+g+'"]').show()},editElement:function(){var e=$(this).closest("li");var f=e.find(".far_display");f.attr("contenteditable","true");if(e.attr("data-status")!="new"){e.attr("data-status","updated")}f.focusin();a.selectText(f)},uneditElement:function(){$(this).attr("contenteditable","false")},assignElement:function(g){var i=a.getSettings(g.target);var e=$(this).closest("li");a.clearBehaviour(e);a.addBehaviour("element",e,i);var j=e.closest(".far-admin-groups");var h=j.find(".far_master_elements").attr("data-id-selected");if(h){var f=e.detach();f.find(".far_display-tag").remove();f.attr("data-relid",h);j.find(".far_elements").find(".newElement").closest("li").before(f)}},newElementMaster:function(h){var k=a.getSettings(h.target);var l=a.template_li_new_item("master",k,false);var f=$(a.getBehaviourTemplate("master",k));var j=a.generateUUID();var e=$(this).closest("li");var g=$(this).closest("ul");var i=$(this).find(".far_display");e.removeClass("newElementMaster");e.attr("data-uid",j);e.attr("data-status","new");g.attr("data-id-selected",j);i.after(f);a.selectText(i);e.after(l)},newElement:function(h){var g=a.getSettings(h.target);var i=a.template_li_new_item("element",g,false);var f=$(a.getBehaviourTemplate("element",g));var k=a.generateUUID();var n=$(this).closest("li");var e=n.closest(".far-admin-groups");var l=e.find("ul").filter(".far_master_elements");var m=$(this).find(".far_display");n.removeClass("newElement");$(this).attr("data-uid",k);$(this).attr("data-status","new");var j=l.attr("data-id-selected");n.attr("data-relid",j);m.after(f);a.selectText(m);m.closest("li").after(i)},newFreeElement:function(h){var g=a.getSettings(h.target);var l=g.template;var i=a.template_li_new_item("free_element",g,false);var f=$(a.getBehaviourTemplate("free_element",g));var e=$(l.assign_element);var j=a.generateUUID();var m=$(this).closest("li");var k=$(this).find(".far_display");m.removeClass("newElementFree");$(this).attr("data-uid",j);$(this).attr("data-status","new");k.before(e);k.after(f);a.selectText(k);m.after(i)},getTemplates:function(e){return a.getSettings(e).template},getSettings:function(e){return $(e).closest(".far-admin-groups").data("settings")},removeElement:function(h){var i=a.getSettings(h.target);var g=i.template;var e=$(this).closest("li");var k=e.closest(".far-admin-groups");var j=e.detach();var f=$(g.assign_element);a.clearBehaviour(e);a.addBehaviour("free_element",e,i);j.find(".far_display").removeAttr("data-relid");j.find(".far_display").before(f);k.find(".far_free_elements").find(".newElementFree").closest("li").before(j)},removeFreeElement:function(){$(this).closest("li").remove()},removeMasterElement:function(i){var g=a.getSettings(i.target);var o=g.template;var l=$(this).closest("li");var f=l.attr("data-uid");var e=l.closest(".far-admin-groups");var j=l.closest("ul");var k=j.attr("data-id-selected");var p=e.find(".far_elements").find("li");var n=p.filter('[data-relid = "'+f+'"]');var m=p.filter(".newElement");var h=e.find(".far_free_elements");a.clearBehaviour(n);a.addBehaviour("free_element",n,g);n.prepend($(o.assign_element));n.show();n.detach();if(f==k){j.removeAttr("data-id-selected");m.hide()}h.find("li").filter(".newElementFree").before(n);l.remove()},clearBehaviour:function(e){e.find("span").filter(".far_display-edit").detach();e.find("span").filter(".far_display-close").detach();e.find("span").filter(".far_display-tag").detach()},addBehaviour:function(g,e,f){var h=$(a.getBehaviourTemplate(g,f));e.find("span").after(h)},template_li_master:function(e,f){return $('<li data-uid="'+e.id+'"><span class="far_display" " contenteditable="false">'+e.desc+"</span>"+a.getBehaviourTemplate("master",f)+"</li>").addClass(f.classes.li_master)},template_li:function(e,f){return $('<li data-uid="'+e.id+'" data-relid="'+e.relId+'" style="display: none;"><span class="far_display" contenteditable="false">'+e.desc+"</span>"+a.getBehaviourTemplate("element",f)+"</li>").addClass(f.classes.li_element)},template_li_free:function(e,f){return $('<li data-uid="'+e.id+'">'+f.template.assign_element+'<span class="far_display" contenteditable="false">'+e.desc+"</span>"+a.getBehaviourTemplate("free_element",f)+"</li>").addClass(f.classes.li_free_element)},template_li_new_item:function(e,g,h){var f="";if(e=="master"){f=$('<li class="newElementMaster">'+a.getNewElementEntity(e,g)+"</li>").addClass(g.classes.li_master)}else{if(e=="element"){f=$('<li class="newElement">'+a.getNewElementEntity(e,g)+"</li>").addClass(g.classes.li_new_element)}else{f=$('<li class="newElementFree">'+a.getNewElementEntity(e,g)+"</li>").addClass(g.classes.li_free_element)}}if(h){f.hide()}return f},template_ul:function(e){return $('<ul class="'+e+'"></<ul>')},getBehaviourTemplate:function(h,g){var f=false;var e=false;switch(h){case"master":f=g.behaviour.li_master_editable;e=g.behaviour.li_master_removable;break;case"element":f=g.behaviour.li_element_editable;e=g.behaviour.li_element_removable;break;case"free_element":f=g.behaviour.li_free_element_editable;e=g.behaviour.li_free_element_removable;break}return a.getBehaviour(f,e,g.template)},getBehaviour:function(f,e,g){var h="";if(f){h+=g.edit_element}if(e){h+=g.close_element}return h},getNewElementText:function(e,f){var g="";switch(e){case"master":g=f.text_new.li_master_text;break;case"element":g=f.text_new.li_element_text;break;case"free_element":g=f.text_new.li_free_element_text;break}return g},getNewElementEntity:function(e,g){var f=$(g.template.new_element);f.text(a.getNewElementText(e,g));return f.wrap("<p/>").parent().html()},createElements:function(h,i,g){var j=h.values[i];var e=h.$content_el.find("."+i);if(!e.length){e=a.template_ul(i);e.appendTo("#"+h.id_container)}$.each(j,function(k,l){if(g=="master"){a.template_li_master(l,h).appendTo(e)}else{if(g=="element"){a.template_li(l,h).appendTo(e)}else{a.template_li_free(l,h).appendTo(e)}}});var f=a.getBehaviourNewItem(g,h);if(g=="element"){f.hide()}f.appendTo(e)},getBehaviourNewItem:function(f,e){var g=(a.getNewElementText(f,e)=="");return a.template_li_new_item(f,e,g)},clearElements:function(f,g){var e=f.$content_el.find("."+g).find("li");e.remove()},getAllElements:function(){var f=$(this).data("settings");var e=$("#"+f.id_container);var g={};g.far_master_elements=a.getElements(e,".far_master_elements",".newElementMaster");g.far_free_elements=a.getElements(e,".far_free_elements",".newElementFree");g.far_elements=a.getElements(e,".far_elements",".newElement");return g},getElements:function(f,j,e){var h=[];var g=f.find(j);var i=g.find("li").not(e);i.each(function(){var k={};k.id=$(this).attr("data-uid");k.desc=$(this).find(".far_display").text();if(j==".far_elements"){k.relId=$(this).attr("data-relid")}k.status=$(this).attr("data-status");h.push(k)});return h},generateUUID:function(){var f=new Date().getTime();var e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(h){var g=(f+Math.random()*16)%16|0;f=Math.floor(f/16);return(h=="x"?g:(g&3|8)).toString(16)});return e},selectText:function(h){var i=document;var f=h[0];if(i.body.createTextRange){var e=document.body.createTextRange();e.moveToElementText(f);e.select()}else{if(b.getSelection){var g=b.getSelection();var e=document.createRange();e.selectNodeContents(f);g.removeAllRanges();g.addRange(e)}}},deselectText:function(){if(document.selection){document.selection.empty()}else{if(b.getSelection){b.getSelection().removeAllRanges()}}},interceptKeys:function(f){if(f.keyCode==13){$(f.target).removeAttr("contenteditable")}return f.which!=13},interceptEscKeys:function(f){if(f.keyCode==27){document.execCommand("Undo",false,0);a.deselectText();$(f.target).removeAttr("contenteditable")}}};$.fn.adminGroupLists=function(e){if(a[e]){return a[e].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof e==="object"||!e){return a.init.apply(this,arguments)}else{$.error("Method "+e+" does not exist on jQuery.adminGroupLists")}}};$.fn.adminGroupLists.defaults={version:"1.0",id_container:"demo",template:{new_element:'<span class="far_display" contenteditable="true"></span>',edit_element:'<span class="fa fa-pencil far_display-edit"></span>',close_element:'<span class="fa fa-times far_display-close close-element"></span>',assign_element:'<span class="fa fa-tag far_display-tag"></span>',},classes:{li_master:"",li_element:"",li_free_element:"",li_new_element:""},text_new:{li_master_text:"New element",li_element_text:"New element",li_free_element_text:"New FREE element"},behaviour:{li_master_editable:true,li_master_removable:true,li_element_editable:true,li_element_removable:true,li_free_element_editable:true,li_free_element_removable:true},values:{far_master_elements:[{id:"1",desc:"Markets"},{id:"4",desc:"Professional services"},{id:"5",desc:"Health"}],far_free_elements:[{id:"7",desc:"Pharmacy"},{id:"8",desc:"Optics"},{id:"9",desc:"Shoes"}],far_elements:[{id:"1",desc:"Supermarket",relId:"1"},{id:"4",desc:"Fruit Store",relId:"1"},{id:"5",desc:"Hardware",relId:"4"}]}}})(window,jQuery);